#include "stm32f4xx.h"
#include "spwm.h"
//uint16_t Counter_sine1 = 0;		//A相
//uint16_t Counter_sine2 = 133;	//滞后A相120度
//uint16_t Counter_sine3 = 266;	//超前A相120度	


//单极性倍频调制，生成反相调制波
uint16_t Counter_sine1 = 0;
uint16_t Counter_sine2 = 200;

int const talab[400] = {    // 0-400 50hz正弦波 开关频率 20khz 调制度默认0.98
    2100, 2132, 2164, 2196, 2229, 2261, 2293, 2325, 2357, 2389, 2421, 2453,
    2485, 2517, 2548, 2580, 2611, 2643, 2674, 2705, 2735, 2766, 2797, 2827,
    2857, 2887, 2917, 2946, 2976, 3005, 3034, 3062, 3091, 3119, 3147, 3175,
    3202, 3229, 3256, 3283, 3309, 3335, 3361, 3386, 3411, 3436, 3460, 3485,
    3508, 3532, 3555, 3577, 3600, 3622, 3643, 3664, 3685, 3706, 3726, 3745,
    3764, 3783, 3802, 3820, 3837, 3854, 3871, 3887, 3903, 3918, 3933, 3948,
    3962, 3975, 3988, 4001, 4013, 4025, 4036, 4047, 4057, 4067, 4076, 4085,
    4093, 4101, 4108, 4115, 4121, 4127, 4132, 4137, 4141, 4145, 4148, 4151,
    4153, 4155, 4156, 4157, 4158, 4157, 4156, 4155, 4153, 4151, 4148, 4145,
    4141, 4137, 4132, 4127, 4121, 4115, 4108, 4101, 4093, 4085, 4076, 4067,
    4057, 4047, 4036, 4025, 4013, 4001, 3988, 3975, 3962, 3948, 3933, 3918,
    3903, 3887, 3871, 3854, 3837, 3820, 3802, 3783, 3764, 3745, 3726, 3706,
    3685, 3664, 3643, 3622, 3600, 3577, 3555, 3532, 3508, 3485, 3460, 3436,
    3411, 3386, 3361, 3335, 3309, 3283, 3256, 3229, 3202, 3175, 3147, 3119,
    3091, 3062, 3034, 3005, 2976, 2946, 2917, 2887, 2857, 2827, 2797, 2766,
    2735, 2705, 2674, 2643, 2611, 2580, 2548, 2517, 2485, 2453, 2421, 2389,
    2357, 2325, 2293, 2261, 2229, 2196, 2164, 2132, 2100, 2067, 2035, 2003,
    1970, 1938, 1906, 1874, 1842, 1810, 1778, 1746, 1714, 1682, 1651, 1619,
    1588, 1556, 1525, 1494, 1464, 1433, 1402, 1372, 1342, 1312, 1282, 1253,
    1223, 1194, 1165, 1137, 1108, 1080, 1052, 1024, 997,  970,  943,  916,
    890,  864,  838,  813,  788,  763,  739,  714,  691,  667,  644,  622,
    599,  577,  556,  535,  514,  493,  473,  454,  435,  416,  397,  379,
    362,  345,  328,  312,  296,  281,  266,  251,  237,  224,  211,  198,
    186,  174,  163,  152,  142,  132,  123,  114,  106,  98,   91,   84,
    78,   72,   67,   62,   58,   54,   51,   48,   46,   44,   43,   42,
    42,   42,   43,   44,   46,   48,   51,   54,   58,   62,   67,   72,
    78,   84,   91,   98,   106,  114,  123,  132,  142,  152,  163,  174,
    186,  198,  211,  224,  237,  251,  266,  281,  296,  312,  328,  345,
    362,  379,  397,  416,  435,  454,  473,  493,  514,  535,  556,  577,
    599,  622,  644,  667,  691,  714,  739,  763,  788,  813,  838,  864,
    890,  916,  943,  970,  997,  1024, 1052, 1080, 1108, 1137, 1165, 1194,
    1223, 1253, 1282, 1312, 1342, 1372, 1402, 1433, 1464, 1494, 1525, 1556,
    1588, 1619, 1651, 1682, 1714, 1746, 1778, 1810, 1842, 1874, 1906, 1938,
    1970, 2003, 2035, 2067};

// // SPWM输出
// void TIM1_CC_IRQHandler(void) {
//   //    Counter_sine=(int)(400*theta/2/M_PI);
//   //    Counter_sine_I=(Counter_sine+200)%400;
//   if (Counter_sine >= 400) {

//     Counter_sine = Counter_sine - 400;
//   }
//   if (Counter_sine_I >= 400) {

//     Counter_sine_I = Counter_sine_I - 400;
//   }
//   if (MI > MI_MAX) {
//     MI = MI_MAX;
//   }
//   // CCR1
//   if (TIM_GetITStatus(TIM1, TIM_IT_CC1) != RESET) {
//     Counter_sine = (int)(400 * theta / 2 / M_PI);
//     TIM_SetCompare1(TIM1, (uint32_t)(talab[Counter_sine] * MI)); // A相
//     TIM_ClearITPendingBit(TIM1, TIM_IT_CC1);
//   }
//   // CCR2
//   if (TIM_GetITStatus(TIM1, TIM_IT_CC2) != RESET) {
//     Counter_sine_I = (Counter_sine + 200) % 400;
//     TIM_SetCompare2(TIM1, ((uint32_t)talab[Counter_sine_I]) * MI); // B相
//     TIM_ClearITPendingBit(TIM1, TIM_IT_CC2);
//   }
// }
